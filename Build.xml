<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="3.5" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>
  
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Release</Configuration>
    <AssemblyVersion>$(BUILD_NUMBER)</AssemblyVersion>
    <ScrewTurnVersion>$(SCREWTURNVERSION)</ScrewTurnVersion>
    <AgentTempDir>$(TEAMCITY_BUILD_TEMPDIR)</AgentTempDir>
  </PropertyGroup>

  <Target Name="Version" BeforeTargets="Build">
    <Message Text="#--------- Updating Versions ---------#" />
    <ItemGroup>
      <AssemblyInfoFiles Include="**/Properties/**/AssemblyInfo.cs;" />
    </ItemGroup>

    <FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyVersion\(".*"\)\]' ReplacementText='AssemblyVersion("$(AssemblyVersion)")]'></FileUpdate>
    <FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyFileVersion\(".*"\)\]' ReplacementText='AssemblyFileVersion("$(AssemblyVersion)")]'></FileUpdate>
  </Target>
  
  <Target Name="Build" AfterTargets="Version">
    <Message Text="#--------- Building ---------#" />
    <MSBuild Projects="ScrewTurn.sln" Targets="Rebuild" Properties="Configuration=$(Configuration)" />
  </Target>


  <Target Name="CopyFiles" AfterTargets="Build">
    <Message Text="#--------- Copying Files $(AgentTempDir)---------#" />
    <!--<Copy SourceFiles="D:\My Documents\Visual Studio 2010\Projects\MSBuildTest\MSBuildTest\bin\**\Release\MSBuildTest.dll" DestinationFiles=""D:\My Documents\Visual Studio 2010\Projects\MSBuildTest\MSBuildTest\%(Filename)"/>-->

    <ItemGroup>
      <NCoverReport1 Include="NCo**\index.html" />
      <NCoverReport2 Include="NCo*\index.html" />
      <NCoverReport3 Include="**\index.html" />
    </ItemGroup>

    <Message Text="#--------- SrcFile @(NCoverReport1) ---------#" />
    <Message Text="#--------- SrcFile $(NCoverReport1) ---------#" />

    <Message Text="#--------- SrcFile @(NCoverReport2) ---------#" />
    <Message Text="#--------- SrcFile $(NCoverReport2) ---------#" />

    <Message Text="#--------- SrcFile @(NCoverReport3) ---------#" />
    <Message Text="#--------- SrcFile $(NCoverReport3) ---------#" />

    <Message Text="#--------- DstFile $(AgentTempDir) ---------#" />

    <Copy SourceFiles="@(NCoverReport1)" DestinationFiles="Coverage1.html"/>
    <Copy SourceFiles="@(NCoverReport2)" DestinationFiles="Coverage2.html"/>
    <Copy SourceFiles="@(NCoverReport3)" DestinationFiles="Coverage3.html"/>
  </Target>
  
  
  <!--<Target Name="CopyFiles">
    <ItemGroup>
      <NCoverReport Include="$(AgentTempDir)\NCover*\index.html"></NCoverReport>
    </ItemGroup>
    <Copy SourceFiles="@(NCoverReport)" DestinationFiles="@(NCoverReport->'.\Coverage.html')"/>
  </Target>-->
</Project>