<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="3.5" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>
  
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Release</Configuration>
    <Version>$(BUILD_NUMBER)</Version>
    <ScrewTurnVersion>$(SCREWTURNVERSION)</ScrewTurnVersion>
  </PropertyGroup>

  <Target Name="Version" BeforeTargets="Build">
    <Message Text="#--------- Updating Versions ---------#" />
    <ItemGroup>
      <AssemblyInfoFiles Include="**/Properties/**/AssemblyInfo.cs;" />
    </ItemGroup>

    <FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyVersion\(".*"\)\]' ReplacementText='AssemblyVersion("$(ScrewTurnVersion)")]'></FileUpdate>
    <FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyFileVersion\(".*"\)\]' ReplacementText='AssemblyFileVersion("$(ScrewTurnVersion)")]'></FileUpdate>

    <!--<FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyVersion\(".*"\)\]' ReplacementText='AssemblyVersion("1.2.3.4")]'></FileUpdate>
    <FileUpdate Files="@(AssemblyInfoFiles)" Regex='AssemblyFileVersion\(".*"\)\]' ReplacementText='AssemblyFileVersion("1.2.3.4")]'></FileUpdate>-->
  </Target>
  
  <Target Name="Build" AfterTargets="Version">
    <Message Text="#--------- Building ---------#" />
    <MSBuild Projects="ScrewTurn.sln" Targets="Rebuild" Properties="Configuration=$(Configuration)" />
  </Target>

</Project>